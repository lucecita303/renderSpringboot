<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Chat en Tiempo Real ðŸ’¬</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body {
          font-family: Arial, sans-serif;
          background: #f4f4f4;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100vh;
        }
        #chat {
          background: white;
          width: 400px;
          height: 500px;
          border-radius: 12px;
          box-shadow: 0 0 10px rgba(0,0,0,0.1);
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }
        #messages {
          flex: 1;
          padding: 10px;
          overflow-y: auto;
        }
        #messages div {
          margin-bottom: 10px;
          padding: 8px 12px;
          border-radius: 8px;
          background: #e1f5fe;
          word-wrap: break-word;
        }
        #form {
          display: flex;
          border-top: 1px solid #ccc;
        }
        input {
          flex: 1;
          border: none;
          padding: 10px;
          font-size: 14px;
        }
        button {
          border: none;
          padding: 10px 15px;
          background: #0288d1;
          color: white;
          cursor: pointer;
        }
    </style>
</head>
<body>
<div id="chat">
    <div id="messages"></div>
    <form id="form" onsubmit="sendMessage(event)">
        <input id="sender" type="text" placeholder="Tu nombre" required />
        <input id="content" type="text" placeholder="Escribe un mensaje..." required />
        <button type="submit">Enviar</button>
    </form>
</div>

<script>
    let stompClient = null;

    function connect() {
      const socket = new SockJS('/chat-websocket');
      stompClient = Stomp.over(socket);
      stompClient.connect({}, function (frame) {
        console.log('Conectado: ' + frame);
        stompClient.subscribe('/topic/messages', function (message) {
          showMessage(JSON.parse(message.body));
        });
      });
    }

    function sendMessage(event) {
      event.preventDefault();
      const sender = document.getElementById('sender').value;
      const content = document.getElementById('content').value;
      if (sender && content) {
        stompClient.send("/app/sendMessage", {}, JSON.stringify({
          sender: sender,
          content: content,
          timestamp: new Date().toLocaleTimeString()
        }));
        document.getElementById('content').value = '';
      }
    }

    function showMessage(message) {
      const messagesDiv = document.getElementById('messages');
      const messageElement = document.createElement('div');
      messageElement.textContent = `[${message.timestamp}] ${message.sender}: ${message.content}`;
      messagesDiv.appendChild(messageElement);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    connect();
</script>
</body>
</html>
